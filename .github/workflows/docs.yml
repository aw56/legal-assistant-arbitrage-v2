name: API Docs Auto Update

on:
  push:
    branches: [ main, develop ]

jobs:
  update-docs:
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0   # –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—É—à–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ

      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"

      # 3. –°—Ç–∞–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 4. –ì–µ–Ω–µ—Ä–∏–º API_DOCS.md
      - name: Generate API Docs
        run: make apidocs

      # 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∫–æ–º–º–∏—Ç–∏–º, –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
      - name: Commit updated API_DOCS.md
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          if ! git diff --quiet docs/API_DOCS.md; then
            git add docs/API_DOCS.md
            git commit -m "üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ API_DOCS.md"
            git push
          else
            echo "‚úÖ API_DOCS.md –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
          fi
