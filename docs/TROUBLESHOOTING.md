# üìÑ `docs/TROUBLESHOOTING.md`

```markdown
# üõ† TROUBLESHOOTING ‚Äî Legal Assistant Arbitrage v2

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–∫–∞—Ç–∞–ª–æ–≥ —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∏ —Ä–µ—à–µ–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –¥–µ–ø–ª–æ–µ –ø—Ä–æ–µ–∫—Ç–∞.

---

## üêò PostgreSQL / psycopg2

### –û—à–∏–±–∫–∞
```

psycopg2.OperationalError: could not translate host name "2025!@db" to address: Name or service not known

````

**–ü—Ä–∏—á–∏–Ω–∞:** –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –±—ã–ª —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω –ø–∞—Ä–æ–ª—å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π `@` –∏–ª–∏ `!`.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `urllib.parse.quote_plus` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è:

```python
from urllib.parse import quote_plus
DB_PASS = quote_plus(os.getenv("POSTGRES_PASSWORD", ""))
````

---

### –û—à–∏–±–∫–∞

```
psycopg2.OperationalError: connection refused
```

**–ü—Ä–∏—á–∏–Ω–∞:** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `backend` —Å—Ç–∞—Ä—Ç—É–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º `db`.

**–†–µ—à–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `wait-for-db.sh` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º FastAPI.
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
make reset-db
```

---

## üìú Alembic

### –û—à–∏–±–∫–∞

```
FAILED: No 'script_location' key found in configuration.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –≤ `alembic.ini` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ü–∏—è `[alembic]`.

**–†–µ—à–µ–Ω–∏–µ:**

```ini
[alembic]
script_location = migrations
sqlalchemy.url =
```

---

### –û—à–∏–±–∫–∞

```
ValueError: invalid interpolation syntax ...
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ø–∞—Ä–æ–ª—å —Å `%` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª.

**–†–µ—à–µ–Ω–∏–µ:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `config.set_main_option("sqlalchemy.url", SQLALCHEMY_URL)` –≤ `migrations/env.py`.

---

### –û—à–∏–±–∫–∞

```
configparser.DuplicateOptionError: option 'script_location' already exists
```

**–ü—Ä–∏—á–∏–Ω–∞:** –≤ `alembic.ini` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –∫–ª—é—á.

**–†–µ—à–µ–Ω–∏–µ:** –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –±–ª–æ–∫ `[alembic]`.

---

## üê≥ Docker

### –û—à–∏–±–∫–∞

```
OCI runtime exec failed: exec failed: "curl": executable file not found
```

**–ü—Ä–∏—á–∏–Ω–∞:** –≤ –æ–±—Ä–∞–∑–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `curl` (–∏–ª–∏ `wget`).

**–†–µ—à–µ–Ω–∏–µ:** –¥–æ–±–∞–≤–∏—Ç—å –≤ Dockerfile:

```dockerfile
RUN apt-get update && apt-get install -y --no-install-recommends curl wget netcat-openbsd
```

---

### –û—à–∏–±–∫–∞

```
Container restarting in loop (–ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫...)
```

**–ü—Ä–∏—á–∏–Ω–∞:** backend —Å—Ç–∞—Ä—Ç—É–µ—Ç –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã.

**–†–µ—à–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `wait-for-db.sh`.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `.env`.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î:

```bash
make reset-db
```

---

### –û—à–∏–±–∫–∞

```
WARN[0000] the attribute `version` is obsolete, it will be ignored
```

**–ü—Ä–∏—á–∏–Ω–∞:** –≤ `docker-compose.yml` –∏–ª–∏ `docker-compose.prod.yml` —É–∫–∞–∑–∞–Ω–æ `version:`.

**–†–µ—à–µ–Ω–∏–µ:** —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É `version: "3.9"` ‚Äî –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Docker Compose –æ–Ω–∞ –Ω–µ –Ω—É–∂–Ω–∞.

---

## üîê .env –∏ –∫–æ–Ω—Ñ–∏–≥–∏

### –û—à–∏–±–∫–∞

```
configparser.MissingSectionHeaderError: File contains no section headers.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –±–∏—Ç—ã–π `alembic.ini`.

**–†–µ—à–µ–Ω–∏–µ:** –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å `alembic.ini` –Ω–∞—á–∏—Å—Ç–æ:

```ini
[alembic]
script_location = migrations
sqlalchemy.url =
```

---

### –û—à–∏–±–∫–∞

```
POSTGRES_HOST=2025!@db
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ø–∞—Ä–æ–ª—å —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ø–∞–ª –≤–º–µ—Å—Ç–æ —Ö–æ—Å—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:** –∏—Å–ø—Ä–∞–≤–∏—Ç—å `.env`:

```dotenv
POSTGRES_USER=admin
POSTGRES_PASSWORD=Admin@2025!
POSTGRES_DB=legal_assistant_db
POSTGRES_HOST=db
POSTGRES_PORT=5432
```

---

## üìÑ Makefile

### –û—à–∏–±–∫–∞

```
Makefile:5: *** missing separator.  Stop.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –≤–º–µ—Å—Ç–æ —Ç–∞–±—É–ª—è—Ü–∏–∏ –≤ —Ä–µ—Ü–µ–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø—Ä–æ–±–µ–ª—ã.

**–†–µ—à–µ–Ω–∏–µ:** —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å **TAB**, –∞ –Ω–µ –ø—Ä–æ–±–µ–ª–æ–≤.

---

## ‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

1. –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–∞—Å—å –æ—à–∏–±–∫–∞ ‚Üí –∏—â–∏ –µ—ë —Ç–µ–∫—Å—Ç –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é.
3. –î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –ë–î –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å:

```bash
make reset-db
```

```

---

–•–æ—á–µ—à—å, —è —Å—Ä–∞–∑—É –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –¥–ª—è —Ç–µ–±—è –∫–æ–º–º–∏—Ç: –¥–æ–±–∞–≤–∏–º —ç—Ç–∏ –¥–≤–∞ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ–ø–∏—à–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∏—Ö –≤ –æ—Å–Ω–æ–≤–Ω–æ–º `README.md`?
```
