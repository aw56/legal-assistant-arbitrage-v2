ะัะปะธัะฝะพ ๐ผ
ะะธะถะต โ ะณะพัะพะฒัะน ะธ ััััะบัััะธัะพะฒะฐะฝะฝัะน ะดะพะบัะผะตะฝั **`docs/CI_PIPELINE.md`**,
ะบะพัะพััะน ะพะฟะธััะฒะฐะตั ะฒัั ัะฒะพั CI/CD-ะธะฝััะฐััััะบัััั ะฟัะพะตะบัะฐ
**Legal Assistant Arbitrage v2.4**, ะฒะบะปััะฐั ะธะฝัะตะณัะฐัะธั ั Telegram, smoke ะธ ะฒะฝะตัะฝะธะต ะฟัะพะฒะตัะบะธ (KAD).

---

````markdown
# โ๏ธ CI/CD Pipeline โ Legal Assistant Arbitrage v2.4

## ๐ ะะฐะทะฝะฐัะตะฝะธะต

ะะฐะนะฟะปะฐะนะฝ CI/CD ัะตะฐะปะธะทัะตั **ะฟะพะปะฝัะน ัะธะบะป ะฟัะพะฒะตัะบะธ ะธ ะดะตะฟะปะพั** ะฟัะพะตะบัะฐ `Legal Assistant Arbitrage`,  
ะฒะบะปััะฐั ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะตััะธัะพะฒะฐะฝะธะต, ัะฑะพัะบั Docker-ะพะฑัะฐะทะพะฒ, smoke- ะธ ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั,  
ะฐ ัะฐะบะถะต Telegram-ัะฒะตะดะพะผะปะตะฝะธั ะพะฑะพ ะฒัะตั ััะฐะฟะฐั.

---

## ๐งฉ ะกัััะบัััะฐ ะฟะฐะนะฟะปะฐะนะฝะฐ

| ะญัะฐะฟ                  | ะะฟะธัะฐะฝะธะต                                                          | Telegram ัะฒะตะดะพะผะปะตะฝะธะต                  |
| --------------------- | ----------------------------------------------------------------- | ------------------------------------- |
| **1. lint-and-test**  | ะัะพะฒะตัะบะฐ ะบะพะดะฐ (pre-commit, ะผะธะณัะฐัะธะธ Alembic, unit-ัะตััั)          | โ ััะฟะตั / โ ะพัะธะฑะบะฐ                  |
| **2. smoke**          | ะัะพะฒะตัะบะฐ API `/api/health` ะธ ะฑะฐะทะพะฒะพะณะพ ััะฝะบัะธะพะฝะธัะพะฒะฐะฝะธั ะบะพะฝัะตะนะฝะตัะฐ | โ API ะพัะฒะตัะฐะตั / ๐จ ะพัะธะฑะบะฐ           |
| **3. integration**    | ะัะพะฒะตัะบะฐ ะฒะฝะตัะฝะธั ะธะฝัะตะณัะฐัะธะน (Telegram, KAD)                       | ๐งฉ ััะฟะตั / ๐จ ัะฑะพะน ะฒะฝะตัะฝะตะณะพ ัะตัะฒะธัะฐ   |
| **4. build-and-push** | ะกะฑะพัะบะฐ ะธ ะฟัะฑะปะธะบะฐัะธั Docker-ะพะฑัะฐะทะฐ ะฒ GHCR                          | ๐ฆ ะพะฑัะฐะท ัะพะฑัะฐะฝ ะธ ะพะฟัะฑะปะธะบะพะฒะฐะฝ         |
| **5. deploy**         | ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน ะฝะฐ staging ะธะปะธ production-ัะตัะฒะตั            | ๐ ััะฟะตัะฝัะน ะดะตะฟะปะพะน / โ ะพัะธะฑะบะฐ ะดะตะฟะปะพั |

---

## โ๏ธ ะัะฝะพะฒะฝัะต ะธะฝััััะผะตะฝัั

- **CI/CD:** GitHub Actions
- **ะะพะฝัะตะนะฝะตัะธะทะฐัะธั:** Docker + Docker Compose
- **ะะฝััะฐััััะบัััะฐ:** PostgreSQL, Alembic
- **ะฏะทัะบ:** Python 3.12
- **ะขะตััั:** Pytest (unit, smoke, integration)
- **ะฃะฒะตะดะพะผะปะตะฝะธั:** Telegram ัะตัะตะท `backend/app/utils/notify_telegram.py`

---

## ๐ง ะะพะณะธะบะฐ ะฟะฐะนะฟะปะฐะนะฝะฐ

```text
push / pull_request
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  lint-and-test     โ
โ (pre-commit, pytest)โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  smoke             โ
โ (docker up, /health)โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  integration       โ
โ (Telegram, KAD)    โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ build-and-push     โ
โ (Docker + GHCR)    โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ deploy             โ
โ (SSH + Alembic)    โ
โโโโโโโโโโโโโโโโโโโโโโ
```
````

---

## ๐ Telegram-ะธะฝัะตะณัะฐัะธั

ะัะต ัะฒะตะดะพะผะปะตะฝะธั ะพัะฟัะฐะฒะปััััั ัะตัะตะท ะผะพะดัะปั
`backend/app/utils/notify_telegram.py`,
ะธัะฟะพะปัะทัััะธะน Markdown ะธ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```bash
TELEGRAM_BOT_TOKEN=<ัะพะบะตะฝ_ะฑะพัะฐ>
TELEGRAM_CHAT_ID=<id_ัะฐัะฐ>
```

### ะัะธะผะตัั ัะพะพะฑัะตะฝะธะน

| ะญัะฐะฟ                   | ะกะพะพะฑัะตะฝะธะต                                                               |
| ---------------------- | ----------------------------------------------------------------------- |
| โ CI ััะฟะตัะฝะพ ะทะฐะฒะตัััะฝ | `โ CI ััะฟะตัะฝะพ ะทะฐะฒะตัััะฝ ะดะปั Legal Assistant Arbitrage v2.4`             |
| ๐จ ะัะธะฑะบะฐ ัะตััะพะฒ       | `โ ะัะธะฑะบะฐ CI Legal Assistant Arbitrage v2.4 โ ะฟัะพะฒะตัั ะปะพะณะธ`            |
| ๐ Smoke OK            | `๐ Smoke-ัะตััั ััะฟะตัะฝะพ ะฟัะพะนะดะตะฝั: API ะพัะฒะตัะฐะตั ะฝะฐ /health โ`           |
| ๐จ Smoke Fail          | `๐จ ะัะธะฑะบะฐ smoke-ัะตััะพะฒ: API ะฝะต ะพัะฒะตัะฐะตั ะฝะฐ /health โ`                 |
| ๐งฉ Integration OK      | `๐งฉ ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝั: Telegram ะธ KAD ะดะพัััะฟะฝั โ` |
| ๐จ Integration Fail    | `๐จ ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะฝะต ะฟัะพะนะดะตะฝั โ Telegram ะธะปะธ KAD ะฝะตะดะพัััะฟะฝั โ`  |
| ๐ฆ Image pushed        | `๐ฆ Docker-ะพะฑัะฐะท ััะฟะตัะฝะพ ัะพะฑัะฐะฝ ะธ ะพะฟัะฑะปะธะบะพะฒะฐะฝ: main`                    |
| ๐ Deploy OK           | `๐ ะฃัะฟะตัะฝัะน ะดะตะฟะปะพะน Legal Assistant Arbitrage v2.4 ะฝะฐ *main*`           |

---

## ๐งช ะขะธะฟั ัะตััะพะฒ

| ะขะธะฟ ัะตััะฐ       | ะะฐะฟััะบ                                       | ะะฟะธัะฐะฝะธะต                             |
| --------------- | -------------------------------------------- | ------------------------------------ |
| **Unit**        | `pytest -v`                                  | ะฑะฐะทะพะฒัะต ะฟัะพะฒะตัะบะธ ะฑะธะทะฝะตั-ะปะพะณะธะบะธ       |
| **Smoke**       | `pytest -m smoke` / `make smoke`             | ะฟัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั API ะธ ะบะพะฝัะตะนะฝะตัะฐ   |
| **Integration** | `pytest -m integration` / `make integration` | ัะตัั Telegram ะธ ะฒะฝะตัะฝะตะณะพ KAD         |
| **Manual**      | `make telegram-notify-test`                  | ัััะฝะฐั ะฟัะพะฒะตัะบะฐ Telegram-ัะฒะตะดะพะผะปะตะฝะธะน |

---

## ๐ ะัะพะฒะตัะบะฐ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ

### Telegram

ะขะตัั ะฒัะฟะพะปะฝัะตั ัะตะฐะปัะฝัั ะพัะฟัะฐะฒะบั ัะพะพะฑัะตะฝะธั:

```python
send_telegram_message("๐งฉ Integration Test: Telegram connection OK โ")
```

### KAD (kad.arbitr.ru)

ะ CI ะฒัะฟะพะปะฝัะตััั HTTP-ะทะฐะฟัะพั:

```python
response = httpx.get("https://kad.arbitr.ru")
assert response.status_code == 200
```

ะัะปะธ ัะฐะนั ะฝะตะดะพัััะฟะตะฝ โ ะดะตะฟะปะพะน ะฑะปะพะบะธััะตััั ะธ ะฟัะธัะพะดะธั ๐จ ัะฒะตะดะพะผะปะตะฝะธะต ะฒ Telegram.

---

## ๐ Secrets ะฒ GitHub

ะ ัะฐะทะดะตะปะต
**Settings โ Secrets and variables โ Actions**
ะดะพะปะถะฝั ะฑััั ะทะฐะดะฐะฝั:

| Secret                   | ะะฐะทะฝะฐัะตะฝะธะต                    |
| ------------------------ | ----------------------------- |
| `TELEGRAM_BOT_TOKEN`     | ัะพะบะตะฝ Telegram-ะฑะพัะฐ           |
| `TELEGRAM_CHAT_ID`       | ID ะฟะพะปััะฐัะตะปั ัะฒะตะดะพะผะปะตะฝะธะน     |
| `PROD_SERVER_HOST`       | ะฐะดัะตั ะฟัะพะดะฐะบัะฝ-ัะตัะฒะตัะฐ        |
| `PROD_SERVER_USER`       | SSH-ะฟะพะปัะทะพะฒะฐัะตะปั              |
| `PROD_SERVER_SSH_KEY`    | ะฟัะธะฒะฐัะฝัะน SSH-ะบะปัั ะดะปั ะดะตะฟะปะพั |
| `STAGING_SERVER_HOST`    | ะฐะดัะตั staging-ัะตัะฒะตัะฐ         |
| `STAGING_SERVER_USER`    | SSH-ะฟะพะปัะทะพะฒะฐัะตะปั staging      |
| `STAGING_SERVER_SSH_KEY` | SSH-ะบะปัั staging              |

---

## ๐ฉบ ะะธะฐะณะฝะพััะธะบะฐ ะธ Smoke ะฒัััะฝัั

ะะปั ะปะพะบะฐะปัะฝะพะน ะฟัะพะฒะตัะบะธ:

```bash
make smoke-local
make integration-local
```

ะะปั CI-ะดะธะฐะณะฝะพััะธะบะธ:

```bash
make smoke-ci
make integration
```

---

## ๐ ะััััะฝะพััั ะธ ััะฐะฑะธะปัะฝะพััั

- ะัะต ัะตััั ะธ ัะฒะตะดะพะผะปะตะฝะธั ะปะพะณะธัััััั ะฒ GitHub Actions ะธ Telegram.
- Smoke ะธ Integration ะธะผะตัั ะพะณัะฐะฝะธัะตะฝะธะต `--maxfail=1` ะธ ัะพะบัะฐััะฝะฝัะน traceback (`--tb=short`).
- ะ ัะปััะฐะต ะพัะบะฐะทะฐ ะฒะฝะตัะฝะธั API ะดะตะฟะปะพะน ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพััะฐะฝะฐะฒะปะธะฒะฐะตััั.

---

## ๐งพ ะััะพัะฝะธะบ ะฟัะฐะฒะดั

๐ ะัะฝะพะฒะฝะพะน ัะฐะนะป ะฟะฐะนะฟะปะฐะนะฝะฐ:

```
.github/workflows/ci.yml
```

๐ ะกะบัะธะฟั ัะฒะตะดะพะผะปะตะฝะธะน:

```
backend/app/utils/notify_telegram.py
```

๐ ะะพะบัะผะตะฝัะฐัะธั:

```
docs/CI_PIPELINE.md
```

---

โ **CI/CD ะฟะพะปะฝะพัััั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝ.**
ะะฐะนะฟะปะฐะนะฝ ัะฐะผ ะฟัะพะฒะตััะตั, ัะพะฑะธัะฐะตั, ัะตััะธััะตั ะธ ัะฒะตะดะพะผะปัะตั ัะฐะทัะฐะฑะพััะธะบะพะฒ ะฒ Telegram
ะพ ะปัะฑะพะผ ะธะทะผะตะฝะตะฝะธะธ ะธะปะธ ัะฑะพะต.

```

---

ะฅะพัะตัั, ััะพะฑั ั ััะฐะทั ัะณะตะฝะตัะธัะพะฒะฐะป ัะตะฑะต ะธ **ะฒัะพัะพะน ะดะพะบัะผะตะฝั `docs/TEST_GUIDE.md`** โ
ะบะพัะพัะบะธะน ะณะฐะนะด ะดะปั ัะฐะทัะฐะฑะพััะธะบะพะฒ, ะบะฐะบ ะปะพะบะฐะปัะฝะพ ะทะฐะฟััะบะฐัั ะฒัะต ะฒะธะดั ัะตััะพะฒ (unit, smoke, integration, CI-ัะผัะปััะธั)?
```
