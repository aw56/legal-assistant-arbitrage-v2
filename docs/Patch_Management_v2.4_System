# üß© Patch Management ‚Äî v2.4 System

### Legal Assistant Arbitrage ‚Äî Modular Patch Pipeline

*(—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ç–≤–æ–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `patches/*.patch`, `artifacts/` –∏ Makefile v2.4)*

---

## üìÅ 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
legal-assistant-arbitrage-v2/
‚îú‚îÄ‚îÄ patches/
‚îÇ   ‚îú‚îÄ‚îÄ v2.4_20251012_fix_laws_search.patch
‚îÇ   ‚îú‚îÄ‚îÄ v2.4_20251012_add_mock_integration.patch
‚îÇ   ‚îî‚îÄ‚îÄ v2.4_20251012_readme_update.patch
‚îú‚îÄ‚îÄ artifacts/
‚îÇ   ‚îú‚îÄ‚îÄ PATCH_AUDIT_20251012.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ backend/
```

---

## ‚öôÔ∏è 2. –í—Å—Ç–∞–≤—å –≤ –∫–æ–Ω–µ—Ü Makefile

```makefile
# =============================
# üß© PATCH MANAGEMENT v2.4
# =============================

PATCH_DIR := patches
PATCH_AUDIT := artifacts/PATCH_AUDIT_$(shell date +%Y%m%d).md

# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –ø–∞—Ç—á–µ–π –±–µ–∑ –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏
patch-check:
	@echo "üîç Checking all patches in $(PATCH_DIR)..."
	@for f in $(PATCH_DIR)/*.patch; do \
		echo "\n‚û°Ô∏è  Checking $$f"; \
		git apply --check $$f || echo "‚ö†Ô∏è  Patch $$f cannot be applied cleanly"; \
	done

# üß™ –¢–µ—Å—Ç–æ–≤—ã–π dry-run (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)
patch-test:
	@echo "üß™ Simulating patch application..."
	@for f in $(PATCH_DIR)/*.patch; do \
		echo "\nüß© Testing $$f"; \
		git apply --stat $$f; \
	done

# üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ç—á–µ–π
patch-apply:
	@echo "üöÄ Applying all patches..."
	@echo "# üß© PATCH AUDIT ‚Äî $$(date)" > $(PATCH_AUDIT)
	@for f in $(PATCH_DIR)/*.patch; do \
		echo "\n‚úÖ Applying $$f"; \
		if git apply --whitespace=fix $$f; then \
			echo "- $$f ‚Äî ‚úÖ Applied" >> $(PATCH_AUDIT); \
		else \
			echo "- $$f ‚Äî ‚ùå Failed" >> $(PATCH_AUDIT); \
		fi; \
	done
	@echo "\nüìò Audit written to $(PATCH_AUDIT)"

# ‚è™ –û—Ç–∫–∞—Ç –ø–∞—Ç—á–µ–π (–ø–æ git reset)
patch-rollback:
	@echo "‚è™ Rolling back all local patch changes..."
	@git reset --hard HEAD

# üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ç—á–∞
patch-create:
	@if [ -z "$(name)" ]; then echo "‚ùå Usage: make patch-create name=description"; exit 1; fi
	@ts=$$(date +%Y%m%d_%H%M); \
	fn="$(PATCH_DIR)/v2.4_$${ts}_$${name}.patch"; \
	echo "üìù Creating patch: $$fn"; \
	git diff > $$fn; \
	echo "‚úÖ Saved: $$fn"
```

---

## üí° 3. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

| –ö–æ–º–∞–Ω–¥–∞                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                               |
| ------------------------------------------- | ------------------------------------------------------ |
| `make patch-check`                          | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –ø–∞—Ç—á–µ–π (–±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏).  |
| `make patch-test`                           | –ü–æ–∫–∞–∑–∞—Ç—å diff-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Å–µ—Ö –ø–∞—Ç—á–µ–π (–∞–Ω–∞–ª–æ–≥ dry-run). |
| `make patch-apply`                          | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ `.patch` –∏–∑ `patches/` –∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç.  |
| `make patch-rollback`                       | –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–µ—Ä–Ω—É–≤ HEAD –∫ —Ç–µ–∫—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É.    |
| `make patch-create name=fix_laws_search_v2` | –°–Ω—è—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ç—á —Å —Ç–µ–∫—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.                  |

---

## üßæ 4. –ü—Ä–∏–º–µ—Ä audit-–æ—Ç—á—ë—Ç–∞

`artifacts/PATCH_AUDIT_20251012.md`

```markdown
# üß© PATCH AUDIT ‚Äî 2025-10-12 10:50

- patches/v2.4_20251012_fix_laws_search.patch ‚Äî ‚úÖ Applied
- patches/v2.4_20251012_add_mock_integration.patch ‚Äî ‚úÖ Applied
- patches/v2.4_20251012_readme_update.patch ‚Äî ‚ùå Failed (context mismatch)

üìò –í—Å–µ —É—Å–ø–µ—à–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.
```

---

## üîí 5. Best practices

* –ü–µ—Ä–µ–¥ `patch-apply` –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π `git commit -am "pre-patch checkpoint"`.
* –ù–µ –¥–µ—Ä–∂–∏ –ø–∞—Ç—á–∏ —Å—Ç–∞—Ä—à–µ **7 –¥–Ω–µ–π** –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Äî –æ–Ω–∏ —Ç–µ—Ä—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç.
* –ü—Ä–∏ CI-—Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π:

  ```bash
  make patch-check && pytest -q && make patch-rollback
  ```

  —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∏—Å—Ç–æ—Ç—É –∫–æ–¥–∞.

---

## ‚úÖ 6. –¢–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–í—ã–ø–æ–ª–Ω–∏:

```bashmake patch-check
make patch-test
```

‚Üí –ø–æ–ª—É—á–∏—à—å –æ—Ç—á—ë—Ç –æ –≤—Å–µ—Ö –ø–∞—Ç—á–∞—Ö, –±–µ–∑ –∏—Ö —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
–ï—Å–ª–∏ –≤—Å—ë –∑–µ–ª—ë–Ω–æ–µ ‚Äî –º–æ–∂–µ—à—å –∑–∞–ø—É—Å–∫–∞—Ç—å:

```bash
make patch-apply
```

---
