–û—Ç–ª–∏—á–Ω–æ ‚öôÔ∏è
–í–æ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏ –¥–µ—Ç–∞–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
**`docs/DEVOPS_OPERATIONS.md`**, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤—Å–µ DevOps-–ø—Ä–æ—Ü–µ—Å—Å—ã,
–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
**Legal Assistant Arbitrage v2.4**.

---

````markdown
# ‚öôÔ∏è DEVOPS OPERATIONS ‚Äî Legal Assistant Arbitrage v2.4

## üìò –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ DevOps-–ø—Ä–æ—Ü–µ—Å—Å—ã –ø—Ä–æ–µ–∫—Ç–∞  
**Legal Assistant Arbitrage v2.4**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CI/CD, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –º–∏–≥—Ä–∞—Ü–∏—è–º–∏, —Ä–µ–∑–µ—Ä–≤–Ω—ã–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ SSH-–¥–µ–ø–ª–æ–µ–º.  
–û–Ω —Å–ª—É–∂–∏—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## üß± 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
| ------------------ | ---------------------------- |
| **FastAPI**        | –æ—Å–Ω–æ–≤–Ω–æ–π backend-—Å–µ—Ä–≤–∏—Å      |
| **PostgreSQL**     | –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö                  |
| **Docker Compose** | —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏      |
| **GitHub Actions** | CI/CD –ø–∞–π–ø–ª–∞–π–Ω               |
| **Alembic**        | –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö         |
| **Telegram Bot**   | —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–∞—Ö CI/CD |
| **GHCR.io**        | —Ä–µ–µ—Å—Ç—Ä Docker-–æ–±—Ä–∞–∑–æ–≤        |

---

## üß≠ 2. –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –¥–µ–ø–ª–æ—è

1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–ª–∞–µ—Ç `git push` –≤ –≤–µ—Ç–∫—É `main` –∏–ª–∏ `staging`.
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **GitHub Actions CI/CD**:
   - ‚úÖ lint –∏ —Ç–µ—Å—Ç—ã,
   - üö¶ smoke `/api/health`,
   - üß© –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Telegram –∏ KAD),
   - üê≥ build & push Docker image,
   - üöÄ –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ SSH).
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ **Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏**.

---

## üß∞ 3. –ö–æ–º–∞–Ω–¥—ã Makefile –¥–ª—è DevOps

| –ö–æ–º–∞–Ω–¥–∞             | –û–ø–∏—Å–∞–Ω–∏–µ                     |
| ------------------- | ---------------------------- |
| `make up`           | –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤           |
| `make down`         | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤   |
| `make restart`      | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend –∏ –ë–î      |
| `make migrate`      | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Alembic –º–∏–≥—Ä–∞—Ü–∏–π  |
| `make wait-for-api` | –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ API      |
| `make smoke`        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API        |
| `make integration`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram –∏ KAD      |
| `make deploy`       | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ SSH  |
| `make doctor`       | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| `make backup-db`    | –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î     |

---

## üß© 4. –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
docker compose -f docker-compose.prod.yml ps
```
````

### –õ–æ–≥–∏ backend

```bash
docker compose -f docker-compose.prod.yml logs -f backend
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ë–î

```bash
docker compose -f docker-compose.prod.yml restart backend
```

### –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose -f docker-compose.prod.yml down
docker compose -f docker-compose.prod.yml up -d --build
```

---

## üóÑÔ∏è 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
make migrate
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
alembic revision -m "add new field to laws"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é

```bash
docker exec -it legal-assistant-backend alembic current
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î

```bash
docker exec -it legal-assistant-db psql -U admin -d legal_assistant_db -c "SELECT now();"
```

---

## üíæ 6. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

```bash
docker exec -t legal-assistant-db pg_dump -U admin legal_assistant_db > artifacts/db_backup_$(date +'%Y%m%d_%H%M%S').sql
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3 (–ø—Ä–∏–º–µ—Ä)

```bash
aws s3 cp artifacts/db_backup_$(date +'%Y%m%d_%H%M%S').sql s3://legal-assistant-backups/
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
cat artifacts/db_backup_2025_10_09.sql | docker exec -i legal-assistant-db psql -U admin -d legal_assistant_db
```

---

## üõ∞Ô∏è 7. SSH-–¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –£—Å–ª–æ–≤–∏—è

- SSH-–∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ GitHub Secrets:
  `PROD_SERVER_SSH_KEY` –∏–ª–∏ `STAGING_SERVER_SSH_KEY`.
- –¶–µ–ª—å –¥–µ–ø–ª–æ—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤–µ—Ç–∫–æ–π:
  - `main` ‚Üí production
  - `staging` ‚Üí staging

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
ssh -i ~/.ssh/prod_legal_assistant.pem user@your-server-ip
```

### –í—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π

```bash
make deploy
```

---

## üîî 8. Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é

```bash
make telegram-notify-test
```

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

| –≠—Ç–∞–ø             | –ü—Ä–∏–º–µ—Ä                         |
| ---------------- | ------------------------------ |
| CI Success       | ‚úÖ CI —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω         |
| Smoke Fail       | üö® –û—à–∏–±–∫–∞ smoke-—Ç–µ—Å—Ç–æ–≤         |
| Integration Fail | üö® Telegram –∏–ª–∏ KAD –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã |
| Deploy OK        | üöÄ –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π             |
| Deploy Fail      | ‚ùå –û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è               |

---

## üîç 9. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
make doctor
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
curl -s http://127.0.0.1:8080/api/health | jq
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
gh run list
gh run view <run_id>
```

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Docker

```bash
docker system prune -af
```

---

## üö® 10. –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö

| –ü—Ä–æ–±–ª–µ–º–∞                     | –î–µ–π—Å—Ç–≤–∏–µ                                               |
| ---------------------------- | ------------------------------------------------------ |
| CI –ø–∞–¥–∞–µ—Ç –Ω–∞ smoke           | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/api/health`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã backend/db         |
| –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏            | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram —Ç–æ–∫–µ–Ω –∏ kad.arbitr.ru               |
| Deploy –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç           | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH Secrets –∏ –ª–æ–≥–∏ `appleboy/ssh-action`     |
| Alembic –∫–æ–Ω—Ñ–ª–∏–∫—Ç             | –í—ã–ø–æ–ª–Ω–∏—Ç—å `make migrate` –ª–æ–∫–∞–ª—å–Ω–æ, –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Ä–µ–≤–∏–∑–∏—é |
| Telegram –Ω–µ —à–ª—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `TELEGRAM_BOT_TOKEN` –∏ `TELEGRAM_CHAT_ID`    |

---

## üßæ 11. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

```bash
git pull origin main
make down
docker system prune -af
make up
make migrate
make wait-for-api
make smoke-local
make integration-local
```

–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã ‚Äî —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é.

---

## üß† 12. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ DevOps

- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π —Ä—É—á–Ω–æ–µ SSH-–≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ ‚Äî CI/CD –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—Å—ë.
- –ü—Ä–æ–≤–µ—Ä—è–π Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—É—à–∞ –≤ `main`.
- –î–µ–ª–∞–π –±—ç–∫–∞–ø—ã –ë–î –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ Alembic.
- –ù–µ —Ö—Ä–∞–Ω–∏ –∫–ª—é—á–∏ –∏ —Ç–æ–∫–µ–Ω—ã –≤ `.env` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π **GitHub Secrets**.
- –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤—ã–ø–æ–ª–Ω—è–π `make doctor` –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ—Å–º–æ—Ç—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## üìú –ò—Å—Ç–æ—á–Ω–∏–∫–∏

| –§–∞–π–ª                                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      |
| -------------------------------------- | ------------------------------- |
| `.github/workflows/ci.yml`             | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CI/CD              |
| `Makefile`                             | –û—Å–Ω–æ–≤–Ω—ã–µ DevOps-–∫–æ–º–∞–Ω–¥—ã         |
| `backend/app/utils/notify_telegram.py` | Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è            |
| `docker-compose.prod.yml`              | –ü—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã             |
| `docs/CI_PIPELINE.md`                  | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞          |
| `docs/TEST_GUIDE.md`                   | –ì–∞–π–¥ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é            |
| `docs/DEVOPS_OPERATIONS.md`            | –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª (DevOps –ø—Ä–æ—Ü–µ–¥—É—Ä—ã) |

---

‚úÖ **Legal Assistant Arbitrage v2.4**
CI/CD –∏ DevOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.
–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –≤ Telegram –∏ GitHub –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –ø—É—à–∞.

```

---

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –¥–æ–ø–æ–ª–Ω–∏–ª –∫–æ–º–ø–ª–µ–∫—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ç–≤—ë—Ä—Ç—ã–º —Ñ–∞–π–ª–æ–º ‚Äî
`docs/DEPLOY_MANUAL.md`, –≥–¥–µ –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω **–ø–æ—ç—Ç–∞–ø–Ω—ã–π —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π** (–µ—Å–ª–∏ CI/CD –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω)?
```
