–û—Ç–ª–∏—á–Ω–æ üöÄ
–í–æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
**`docs/DEPLOY_MANUAL.md`** ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ **—Ä—É—á–Ω–æ–º—É –¥–µ–ø–ª–æ—é –ø—Ä–æ–µ–∫—Ç–∞ Legal Assistant Arbitrage v2.4**,
–µ—Å–ª–∏ CI/CD –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤–∞—Ä–∏–π–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ.

---

````markdown
# üöÄ DEPLOY MANUAL ‚Äî Legal Assistant Arbitrage v2.4

## üìò –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø–æ—à–∞–≥–æ–≤—ã–π —Ä—É—á–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è** –ø—Ä–æ–µ–∫—Ç–∞  
**Legal Assistant Arbitrage v2.4**, –≤–∫–ª—é—á–∞—è —Å–±–æ—Ä–∫—É Docker-–æ–±—Ä–∞–∑–∞, –º–∏–≥—Ä–∞—Ü–∏–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤  
–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## üß© 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç      | –ü—Ä–æ–≤–µ—Ä–∫–∞                                             |
| -------------- | ---------------------------------------------------- |
| Docker         | `docker --version`                                   |
| Docker Compose | `docker compose version`                             |
| Python 3.12+   | `python3 --version`                                  |
| Git            | `git --version`                                      |
| PostgreSQL     | `docker ps` ‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `legal-assistant-db` –∞–∫—Ç–∏–≤–µ–Ω |

---

## üîê 2. SSH-–¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

–ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:

```bash
ssh -i ~/.ssh/prod_legal_assistant.pem user@your-server-ip
```
````

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –∏–¥—ë—Ç –Ω–∞ staging:

```bash
ssh -i ~/.ssh/staging_legal_assistant.pem user@staging-server-ip
```

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/opt/legal-assistant/`.

```bash
cd /opt/legal-assistant
```

---

## üß± 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞

```bash
git fetch origin main
git checkout main
git pull origin main
```

–ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ç–∫—É:

```bash
git branch
```

–û–∂–∏–¥–∞–µ—Ç—Å—è: `* main`

---

## üê≥ 4. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Å –Ω—É–ª—è

```bash
docker compose -f docker-compose.prod.yml down
docker system prune -af
docker compose -f docker-compose.prod.yml up -d --build
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose -f docker-compose.prod.yml ps
```

–û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã:

- `legal-assistant-backend`
- `legal-assistant-db`

---

## üóÑÔ∏è 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Alembic

```bash
docker compose -f docker-compose.prod.yml exec -T backend alembic upgrade head
```

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
docker compose -f docker-compose.prod.yml exec -T backend alembic current
docker compose -f docker-compose.prod.yml exec -T backend alembic history
```

---

## ‚ù§Ô∏è 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:

```bash
curl -s http://127.0.0.1:8080/api/health | jq
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "status": "ok"
}
```

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É:

```bash
curl -s http://0.0.0.0:8080/api/health
```

---

## üß† 7. Smoke-—Ç–µ—Å—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
make smoke-local
```

–∏–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
pytest -m smoke -v
```

–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ:

```
‚úÖ –í—Å–µ smoke-—Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã!
```

---

## üåê 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (Telegram –∏ KAD)

### Telegram

```bash
make telegram-notify-test
```

–û–∂–∏–¥–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:

> üöÄ Legal Assistant Arbitrage: —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç CI

### KAD ([https://kad.arbitr.ru](https://kad.arbitr.ru))

```bash
python3 - <<'PYCODE'
import httpx
r = httpx.get("https://kad.arbitr.ru", timeout=10)
print("‚úÖ KAD –¥–æ—Å—Ç—É–ø–µ–Ω" if r.status_code == 200 else f"‚ùå KAD –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ({r.status_code})")
PYCODE
```

---

## üì¶ 9. –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É—à Docker-–æ–±—Ä–∞–∑–∞

–ï—Å–ª–∏ GHCR (GitHub Container Registry) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω,
–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –≤—Ä—É—á–Ω—É—é.

```bash
docker build -t legal-assistant-backend:manual -f Dockerfile .
docker tag legal-assistant-backend:manual ghcr.io/aw56/legal-assistant-backend:manual
docker push ghcr.io/aw56/legal-assistant-backend:manual
```

---

## üßæ 10. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
docker compose -f docker-compose.prod.yml restart backend
```

---

## ü©∫ 11. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

| –°–∏–º–ø—Ç–æ–º                 | –ü—Ä–æ–≤–µ—Ä–∫–∞ / –†–µ—à–µ–Ω–∏–µ                                           |
| ----------------------- | ------------------------------------------------------------ |
| ‚ùå `API not responding` | `docker logs legal-assistant-backend`                        |
| ‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏      | `docker exec -it backend alembic heads`                      |
| ‚ùå Telegram –Ω–µ —à–ª—ë—Ç     | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `TELEGRAM_BOT_TOKEN` –∏ `CHAT_ID`                   |
| ‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î  | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `legal-assistant-db` –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `DB_*` |
| ‚ùå KAD –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω       | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS –∏ DNS, –≤–æ–∑–º–æ–∂–Ω–æ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±–æ–π         |

---

## üíæ 12. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –¥–µ–ø–ª–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ë–î:

```bash
docker exec -t legal-assistant-db pg_dump -U admin legal_assistant_db > artifacts/db_backup_$(date +'%Y%m%d_%H%M%S').sql
```

---

## üîÑ 13. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –ü–µ—Ä–µ–π–¥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

   ```
   http://<SERVER_IP>:8080/docs
   ```

2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ FastAPI UI –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
3. –ü—Ä–æ–≤–µ—Ä—å endpoints `/api/health`, `/api/laws`, `/api/decisions`.
4. –ü—Ä–æ–≤–µ—Ä—å Telegram: –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ

   > ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π Legal Assistant Arbitrage v2.4 –Ω–∞ _main_

---

## üßπ 14. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∫—ç—à–∞

```bash
docker system prune -af
docker volume prune -f
```

---

## üõ†Ô∏è 15. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
cat artifacts/db_backup_2025_10_09.sql | docker exec -i legal-assistant-db psql -U admin -d legal_assistant_db
```

---

## üîî 16. Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Ä—É—á–Ω–æ–º –¥–µ–ø–ª–æ–µ

–î–ª—è —Ä—É—á–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

```bash
python3 backend/app/utils/notify_telegram.py "üöÄ –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π Legal Assistant Arbitrage v2.4 –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ ‚úÖ"
```

–∏–ª–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:

```bash
python3 backend/app/utils/notify_telegram.py "‚ùå –û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è Legal Assistant Arbitrage v2.4 ‚Äî –ø—Ä–æ–≤–µ—Ä—å —Å–µ—Ä–≤–µ—Ä!"
```

---

## üìã 17. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è)

| –≠—Ç–∞–ø | –ö–æ–º–∞–Ω–¥–∞                        | –û–∂–∏–¥–∞–Ω–∏–µ                          |
| ---- | ------------------------------ | --------------------------------- |
| 1    | `git pull origin main`         | ‚úÖ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–¥                 |
| 2    | `docker compose down`          | ‚úÖ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã         |
| 3    | `docker system prune -af`      | üßπ –æ—á–∏—â–µ–Ω –∫—ç—à                     |
| 4    | `docker compose up -d --build` | üê≥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã            |
| 5    | `make migrate`                 | üóÑÔ∏è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏             |
| 6    | `make smoke-local`             | üö¶ –ø—Ä–æ–≤–µ—Ä–µ–Ω API                   |
| 7    | `make integration-local`       | üß© –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã Telegram –∏ KAD       |
| 8    | `make doctor`                  | ü©∫ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ –ø–æ—Ä—è–¥–∫–µ            |
| 9    | Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ           | üîî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è |

---

## ‚úÖ –†–µ–∑—é–º–µ

**Legal Assistant Arbitrage v2.4** –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç:

- —á–µ—Ä–µ–∑ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI/CD (GitHub Actions)**
- –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ –¥–∞–Ω–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–ü—Ä–∏ —Ä—É—á–Ω–æ–º –¥–µ–ø–ª–æ–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è:

- —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤,
- –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏,
- –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã,
- –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

---

üõ°Ô∏è **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ DevOps-–∏–Ω–∂–µ–Ω–µ—Ä–æ–º –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å–∏—Å—Ç–µ–º—ã.**

```

---

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—è—Ç—ã–π –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî
`docs/ROLLBACK_MANUAL.md`, –≥–¥–µ –±—É–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–æ,
–∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–æ—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–∏** (rollback) –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Docker, Git –∏ Alembic?
```
