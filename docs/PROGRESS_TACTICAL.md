# üß≠ Legal Assistant Arbitrage v2 ‚Äî –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

**–ü–µ—Ä–∏–æ–¥:** 2025-10-06 ‚Üí 2025-10-08
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** admin@legal-assistant
**–¶–µ–ª—å:** –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (KAD API) + –∑–∞–ø—É—Å–∫ CI-–≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1) –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `httpx`, `respx`, `pytest-asyncio`, `ruff`, `pre-commit`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω `pytest.ini` —Å `asyncio_mode=auto`
- –û–±–Ω–æ–≤–ª—ë–Ω `requirements.txt` —Å dev-—Ä–∞–∑–¥–µ–ª–æ–º
- –î–æ–±–∞–≤–ª–µ–Ω—ã `__init__.py` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`make venv-reset`) –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ ‚Äî ‚úÖ

### 2) –ú–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ KAD
- –°–æ–∑–¥–∞–Ω: `backend/app/integrations/kad_api.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç `KadAPI` –Ω–∞ `httpx.AsyncClient`
  - –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: `CaseShort`, `CaseDetails`, `DocumentMeta`
  - –ò—Å–∫–ª—é—á–µ–Ω–∏—è: `KadError`, `KadNotFound`, `KadAuthError`, `KadValidationError`
  - Retry, —Ç–∞–π–º–∞—É—Ç—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è API-–æ—Ç–≤–µ—Ç–æ–≤
  - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ `KadSync` –¥–ª—è CLI/—Å–∫—Ä–∏–ø—Ç–æ–≤
- –ü—Ä–æ–π–¥–µ–Ω –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤:
```bash
pytest -q backend/app/tests/test_kad_api.py -vv
‚úÖ 6 passed in 0.32s
```
- –õ–∏–Ω—Ç–µ—Ä `ruff` ‚Äî ‚úÖ –±–µ–∑ –æ—à–∏–±–æ–∫ (`make kad-lint`)

### 3) FastAPI-—É—Ä–æ–≤–µ–Ω—å
- –°–æ–∑–¥–∞–Ω —Ä–æ—É—Ç `backend/app/routes/kad.py`
- –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/kad/search?q=...`
- –ü–æ–¥–∫–ª—é—á—ë–Ω –≤ `main.py`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–æ–º:
```bash
curl "http://127.0.0.1:8000/api/kad/search?q=A40"
‚Üí {"detail": "Resource not found: https://kad.arbitr.ru/api/cases/search"}
```
(–æ–∂–∏–¥–∞–µ–º–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º API/–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞)
- –î–æ–±–∞–≤–ª–µ–Ω `/api/kad/health` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"status": "ok"}`

### 4) Health-Check
- –†–∞—Å—à–∏—Ä–µ–Ω `/api/health` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
  - PostgreSQL (SQLAlchemy)
  - KAD API (—á–µ—Ä–µ–∑ `services/kad_service`)

**–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "services": {
    "db": "ok",
    "kad": "ok"
  }
}
```

### 5) Docker & CI
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ `entrypoint.sh`
- –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```
legal-assistant-db   Up 6 min  0.0.0.0:5432->5432/tcp
legal-assistant-api  Up 10 s   0.0.0.0:8000->8000/tcp
```
- Makefile –¥–æ–ø–æ–ª–Ω–µ–Ω –±–ª–æ–∫–æ–º –∑–∞–¥–∞—á:
```
kad-test / kad-lint / kad-env-example
run-docker-safe
```
- –î–æ–±–∞–≤–ª–µ–Ω workflow: `.github/workflows/ci_kad.yml`

**–†–µ–∑—É–ª—å—Ç–∞—Ç CI:**
üß™ `KAD Integration & API Health CI` ‚Äî ‚úÖ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à—ë–ª –Ω–∞ GitHub Actions

---

## üìä –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞
–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
- –ø–µ—Ä–≤–æ–µ –≤–Ω–µ—à–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (KAD),
- —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/kad/search`,
- CI-–ø–∞–π–ø–ª–∞–π–Ω, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é,
- –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π health-—Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üîú –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
- –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Ä–≤–∏—Å-—Å–ª–æ–π `kad_service.py`
- –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏: `pravo_gov.py`, `data_gov_laws.py`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Telegram-–±–æ—Ç (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è/–ø–æ–∏—Å–∫)

üìÖ **–§–∏–∫—Å–∞—Ü–∏—è:** 2025-10-08
üìò **–ü–µ—Ä–µ–¥–∞–Ω–æ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫ (v2.4)**
